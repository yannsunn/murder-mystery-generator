/**
 * ğŸ­ Mock Data Generator - å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œç”¨ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå™¨
 * ç’°å¢ƒå¤‰æ•°ãªã—ã§ã‚‚ãƒªã‚¢ãƒ«ãªãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ã‚’ç”Ÿæˆ
 */

const { logger } = require('./logger.js');

// åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
const MOCK_TEMPLATES = {
  titles: [
    'é›ªå±±ã®é¤¨ã®æ®ºäººäº‹ä»¶',
    'æ¶ˆãˆãŸéºç”£ã¨æœ€å¾Œã®æ™©é¤',
    'æ·±å¤œç‰¹æ€¥ã®å¯†å®¤æ®ºäºº',
    'å­¤å³¶ã®å¤åŸã«éŸ¿ãéŠƒå£°',
    'ä»®é¢èˆè¸ä¼šã®æ‚²åŠ‡',
    'æº€æœˆã®å¤œã®é€£ç¶šæ®ºäºº',
    'é–‰ã–ã•ã‚ŒãŸç ”ç©¶æ‰€ã®è¬',
    'è±ªè¯å®¢èˆ¹æœ€å¾Œã®èˆªæµ·'
  ],
  
  settings: [
    { name: 'é›ªå±±ã®å±±è˜', description: 'å¹é›ªã§å¤–ç•Œã‹ã‚‰éš”çµ¶ã•ã‚ŒãŸå±±è˜' },
    { name: 'å­¤å³¶ã®æ´‹é¤¨', description: 'åµã§èˆ¹ãŒå‡ºã›ãªã„çµ¶æµ·ã®å­¤å³¶' },
    { name: 'è±ªè¯å®¢èˆ¹', description: 'å¤§æµ·åŸã‚’èˆªè¡Œä¸­ã®è±ªè¯å®¢èˆ¹' },
    { name: 'å¤åŸ', description: 'æ­´å²ã‚ã‚‹å¤åŸã§ã®æ™©é¤ä¼š' },
    { name: 'ç ”ç©¶æ–½è¨­', description: 'æ¥µç§˜ç ”ç©¶ã‚’è¡Œã†éš”é›¢æ–½è¨­' }
  ],
  
  characterTypes: [
    { role: 'åŒ»å¸«', traits: 'å†·é™æ²ˆç€ã€è¦³å¯ŸåŠ›ãŒé‹­ã„' },
    { role: 'å®Ÿæ¥­å®¶', traits: 'é‡å¿ƒçš„ã€ç§˜å¯†ãŒå¤šã„' },
    { role: 'åŸ·äº‹', traits: 'å¿ å®Ÿã€å…¨ã¦ã‚’è¦‹ã¦ã„ã‚‹' },
    { role: 'æ¢åµ', traits: 'è«–ç†çš„ã€çœŸå®Ÿã‚’è¿½æ±‚' },
    { role: 'ä»¤å¬¢', traits: 'æ°—å“ãŒã‚ã‚‹ã€å®Ÿã¯å¼·ã‹' },
    { role: 'ä½œå®¶', traits: 'æƒ³åƒåŠ›è±Šã‹ã€äººé–“è¦³å¯ŸãŒè¶£å‘³' },
    { role: 'å¼è­·å£«', traits: 'å¼ãŒç«‹ã¤ã€æ­£ç¾©æ„ŸãŒå¼·ã„' },
    { role: 'è¨˜è€…', traits: 'å¥½å¥‡å¿ƒæ—ºç››ã€çœŸç›¸ã‚’æš´ããŸãŒã‚‹' }
  ],
  
  motives: [
    'éºç”£ç›¸ç¶šã‚’å·¡ã‚‹äº‰ã„',
    'éå»ã®å¾©è®',
    'ç§˜å¯†ã®æš´éœ²ã‚’é˜²ããŸã‚',
    'æ­ªã‚“ã æ„›æƒ…',
    'æ­£ç¾©ã®åŸ·è¡Œ',
    'éš ã•ã‚ŒãŸè¡€ç¸é–¢ä¿‚'
  ],
  
  tricks: [
    'å¯†å®¤ãƒˆãƒªãƒƒã‚¯',
    'ã‚¢ãƒªãƒã‚¤ãƒˆãƒªãƒƒã‚¯',
    'å…¥ã‚Œæ›¿ã‚ã‚Šãƒˆãƒªãƒƒã‚¯',
    'æ™‚é–“å·®ãƒˆãƒªãƒƒã‚¯',
    'å‡¶å™¨ã™ã‚Šæ›¿ãˆãƒˆãƒªãƒƒã‚¯'
  ],
  
  evidence: [
    { name: 'è¡€ç—•ã®ã¤ã„ãŸæ‰‹è¢‹', type: 'ç‰©çš„è¨¼æ‹ ' },
    { name: 'ç ´ã‚‰ã‚ŒãŸæ‰‹ç´™', type: 'æ–‡æ›¸è¨¼æ‹ ' },
    { name: 'ç›®æ’ƒè¨¼è¨€ãƒ¡ãƒ¢', type: 'è¨¼è¨€' },
    { name: 'å‡¶å™¨ã®åŒ…ä¸', type: 'ç‰©çš„è¨¼æ‹ ' },
    { name: 'é˜²çŠ¯ã‚«ãƒ¡ãƒ©æ˜ åƒ', type: 'è¨˜éŒ²' },
    { name: 'è¢«å®³è€…ã®æ—¥è¨˜', type: 'æ–‡æ›¸è¨¼æ‹ ' }
  ]
};

// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åç”Ÿæˆç”¨ãƒ‡ãƒ¼ã‚¿
const NAMES = {
  first: ['å¤ªéƒ', 'èŠ±å­', 'å¥ä¸€', 'ç¾å’²', 'ç¿”å¤ª', 'æ„›å­', 'å¤§è¼”', 'ç”±ç¾'],
  last: ['ç”°ä¸­', 'ä½è—¤', 'éˆ´æœ¨', 'é«˜æ©‹', 'æ¸¡è¾º', 'å±±ç”°', 'ä¸­æ‘', 'å°æ—']
};

/**
 * ãƒ©ãƒ³ãƒ€ãƒ é¸æŠãƒ˜ãƒ«ãƒ‘ãƒ¼
 */
function randomSelect(array) {
  return array[Math.floor(Math.random() * array.length)];
}

function randomNumber(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

/**
 * ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¯ãƒ©ã‚¹
 */
class MockDataGenerator {
  constructor() {
    this.sessionId = `mock_${Date.now()}`;
    this.usedNames = new Set();
  }

  /**
   * ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªåå‰ã‚’ç”Ÿæˆ
   */
  generateUniqueName() {
    let attempts = 0;
    while (attempts < 50) {
      const firstName = randomSelect(NAMES.first);
      const lastName = randomSelect(NAMES.last);
      const fullName = `${lastName} ${firstName}`;
      
      if (!this.usedNames.has(fullName)) {
        this.usedNames.add(fullName);
        return fullName;
      }
      attempts++;
    }
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šç•ªå·ä»˜ãåå‰
    const num = this.usedNames.size + 1;
    const name = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${num}`;
    this.usedNames.add(name);
    return name;
  }

  /**
   * æ®µéš0: ãƒ©ãƒ³ãƒ€ãƒ å…¨ä½“æ§‹é€ ç”Ÿæˆ
   */
  generateStage0(formData) {
    const title = randomSelect(MOCK_TEMPLATES.titles);
    const setting = randomSelect(MOCK_TEMPLATES.settings);
    const trick = randomSelect(MOCK_TEMPLATES.tricks);
    const motive = randomSelect(MOCK_TEMPLATES.motives);
    
    return `## ä½œå“åŸºæœ¬æƒ…å ±ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ç‰ˆï¼‰
**ä½œå“ã‚¿ã‚¤ãƒˆãƒ«**: ${title}
**åŸºæœ¬ã‚³ãƒ³ã‚»ãƒ—ãƒˆ**: ${setting.description}ã‚’èˆå°ã«ã—ãŸæœ¬æ ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼
**èˆå°è¨­å®š**: ${setting.name}

## äº‹ä»¶ã®å¤§ã¾ã‹ãªæ§‹é€ ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ç‰ˆï¼‰
**äº‹ä»¶ã®ç¨®é¡**: æ®ºäººäº‹ä»¶
**çŠ¯äººã®æ•°**: å˜ç‹¬çŠ¯
**åŸºæœ¬çš„ãªå‹•æ©Ÿ**: ${motive}
**ä¸»ãªãƒˆãƒªãƒƒã‚¯**: ${trick}

## ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å¤§ã¾ã‹ãªå½¹å‰²ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ç‰ˆï¼‰
${Array.from({length: parseInt(formData.participants || 5)}, (_, i) => 
  `**ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i + 1}**: ${randomSelect(MOCK_TEMPLATES.characterTypes).role}`
).join('\n')}

## é‡è¦ãªè¦ç´ ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ç‰ˆï¼‰
**ä¸»ãªè¨¼æ‹ **: ${randomSelect(MOCK_TEMPLATES.evidence).name}
**ã‚­ãƒ¼ã¨ãªã‚‹æ‰‹ãŒã‹ã‚Š**: è¢«å®³è€…ã®æœ€å¾Œã®è¨€è‘‰
**ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ**: äº‹ä»¶ç™ºç”Ÿã¨çœŸç›¸è§£æ˜

## å¤§ã¾ã‹ãªè§£æ±ºãƒ•ãƒ­ãƒ¼ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ç‰ˆï¼‰
**ç¬¬1æ®µéš**: äº‹ä»¶ç™ºç”Ÿãƒ»ç¾å ´ä¿å…¨
**ç¬¬2æ®µéš**: è¨¼æ‹ åé›†ãƒ»ã‚¢ãƒªãƒã‚¤ç¢ºèª  
**ç¬¬3æ®µéš**: æ¨ç†ãƒ»çŠ¯äººç‰¹å®š`;
  }

  /**
   * æ®µéš1: ã‚³ãƒ³ã‚»ãƒ—ãƒˆç²¾å¯†åŒ–
   */
  generateStage1(formData, previousData) {
    const complexity = formData.complexity || 'standard';
    const playTime = complexity === 'simple' ? '30åˆ†' : complexity === 'complex' ? '60åˆ†' : '45åˆ†';
    
    return `## ä½œå“ã‚¿ã‚¤ãƒˆãƒ«
${randomSelect(MOCK_TEMPLATES.titles)}

## ä½œå“ã‚³ãƒ³ã‚»ãƒ—ãƒˆ
${randomSelect(MOCK_TEMPLATES.settings).description}ã‚’èˆå°ã«ã€${randomSelect(MOCK_TEMPLATES.motives)}ã‚’å·¡ã‚‹æœ¬æ ¼æ¨ç†åŠ‡ã€‚
å‚åŠ è€…å…¨å“¡ãŒé‡è¦ãªå½¹å‰²ã‚’æŒã¡ã€èª°ã‚‚ãŒçŠ¯äººã§ã‚ã‚‹å¯èƒ½æ€§ã‚’ç§˜ã‚ã¦ã„ã¾ã™ã€‚
${playTime}ã¨ã„ã†çŸ­æ™‚é–“ã§ã€ç·Šå¼µæ„Ÿã‚ãµã‚Œã‚‹æ¨ç†ä½“é¨“ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚

## èˆå°è¨­å®šè©³ç´°
### åŸºæœ¬è¨­å®š
æ™‚ä»£: ç¾ä»£
å ´æ‰€: ${randomSelect(MOCK_TEMPLATES.settings).name}
çŠ¶æ³: å¤–ç•Œã‹ã‚‰éš”çµ¶ã•ã‚ŒãŸå¯†å®¤çŠ¶æ…‹

### é›°å›²æ°—ãƒ»ãƒˆãƒ¼ãƒ³è¨­è¨ˆ
${formData.tone === 'serious' ? 'é‡åšã§ç·Šè¿«æ„Ÿã®ã‚ã‚‹' : formData.tone === 'comedic' ? 'è»½å¿«ã§ãƒ¦ãƒ¼ãƒ¢ã‚¢ã®ã‚ã‚‹' : 'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸ'}é›°å›²æ°—

### ç‹¬è‡ªè¦ç´ ãƒ»å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ
- å…¨å“¡ãŒç§˜å¯†ã‚’æŠ±ãˆã¦ã„ã‚‹
- èª°ã‚‚ãŒå‹•æ©Ÿã‚’æŒã£ã¦ã„ã‚‹
- æœ€å¾Œã¾ã§çŠ¯äººãŒåˆ†ã‹ã‚‰ãªã„æ§‹æˆ

## ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å½¹è·æ¦‚è¦
${formData.participants}äººãã‚Œãã‚ŒãŒç‹¬è‡ªã®èƒŒæ™¯ã¨ç§˜å¯†ã‚’æŒã¤ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼

## äº‹ä»¶ã®æ ¸å¿ƒ
æ·±å¤œã«ç™ºç”Ÿã—ãŸæ®ºäººäº‹ä»¶ã€‚è¢«å®³è€…ã¯å…¨å“¡ã¨ä½•ã‚‰ã‹ã®é–¢ä¿‚ãŒã‚ã‚Šã€ãã‚Œãã‚Œã«å‹•æ©ŸãŒ...

## å°å…¥ã‚·ãƒŠãƒªã‚ªï¼ˆå…¨ä½“é…å¸ƒç”¨ãƒ»å®Œçµç‰ˆï¼‰
é™ã‹ãªå¤œã€çªç„¶éŸ¿ãæ¸¡ã‚‹æ‚²é³´ã€‚é§†ã‘ã¤ã‘ãŸä¸€åŒãŒè¦‹ãŸã‚‚ã®ã¯ã€å¤‰ã‚ã‚Šæœã¦ãŸå§¿ã®è¢«å®³è€…ã ã£ãŸã€‚
å¤–ã¯åµã€‚è­¦å¯Ÿã‚’å‘¼ã¶ã“ã¨ã¯ã§ããªã„ã€‚ã“ã®ä¸­ã«çŠ¯äººãŒã„ã‚‹ã€‚
ä»Šã€ç”Ÿãæ®‹ã‚Šã‚’ã‹ã‘ãŸæ¨ç†ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã‚‹...`;
  }

  /**
   * æ®µéš2: äº‹ä»¶æ ¸å¿ƒéƒ¨ã®è¨­è¨ˆ
   */
  generateStage2(formData, previousData) {
    const criminalNum = randomNumber(1, parseInt(formData.participants));
    
    return `## äº‹ä»¶ã®æ ¸å¿ƒæ§‹é€ 

### çŠ¯äººã®ç‰¹å®š
**çœŸã®çŠ¯äºº**: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${criminalNum}
**çŠ¯äººã®ç‰¹å¾´**: ä¸€è¦‹ã™ã‚‹ã¨æœ€ã‚‚ç–‘ã‚ã‚Œã«ãã„äººç‰©

### æ ¹æœ¬çš„å‹•æ©Ÿ
**ä¸»å‹•æ©Ÿ**: ${randomSelect(MOCK_TEMPLATES.motives)}
**å‰¯æ¬¡çš„è¦å› **: é•·å¹´ã®æ¨ã¿ã¨æœ€è¿‘ã®æ±ºå®šçš„ãªå‡ºæ¥äº‹
**éš ã—ãŸã„ç§˜å¯†**: è¢«å®³è€…ã¨ã®éš ã•ã‚ŒãŸé–¢ä¿‚

### çŠ¯è¡Œæ‰‹æ®µãƒ»ãƒˆãƒªãƒƒã‚¯
**åŸºæœ¬çš„ãªæ‰‹æ®µ**: æ·±å¤œã®çŠ¯è¡Œ
**ä½¿ç”¨ã—ãŸãƒˆãƒªãƒƒã‚¯**: ${randomSelect(MOCK_TEMPLATES.tricks)}
**çŠ¯è¡Œæ™‚åˆ»**: åˆå‰2æ™‚é ƒ

### é‡è¦ãªè¨¼æ‹ 
**ç‰©çš„è¨¼æ‹ **: ${randomSelect(MOCK_TEMPLATES.evidence).name}
**çŠ¶æ³è¨¼æ‹ **: ç¾å ´ã®ä¸è‡ªç„¶ãªçŠ¶æ³
**è¨¼è¨€è¨¼æ‹ **: çŸ›ç›¾ã™ã‚‹è¤‡æ•°ã®ç›®æ’ƒè¨¼è¨€

### ãƒŸã‚¹ãƒªãƒ¼ãƒ‰è¦ç´ ï¼ˆç°¡æ½”ç‰ˆï¼‰
ä»–ã®å‚åŠ è€…ã‚‚å‹•æ©ŸãŒã‚ã‚Šã€æ€ªã—ã„è¡Œå‹•ã‚’ã—ã¦ã„ãŸ`;
  }

  /**
   * æ®µéš3: äº‹ä»¶è©³ç´°ãƒ»ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
   */
  generateStage3(formData, previousData) {
    return `## äº‹ä»¶ç™ºç”Ÿå‰ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆç°¡æ½”ç‰ˆï¼‰
### é‡è¦å‰å²ï¼ˆäº‹ä»¶1é€±é–“å‰ã€œï¼‰
- 1é€±é–“å‰: è¢«å®³è€…ãŒé‡è¦ãªæ±ºå®šã‚’ä¸‹ã™
- 3æ—¥å‰: é–¢ä¿‚è€…å…¨å“¡ã«æ‹›å¾…çŠ¶ãŒå±Šã
- å‰æ—¥: å…¨å“¡ãŒç¾åœ°ã«åˆ°ç€

### äº‹ä»¶å½“æ—¥ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆè©³ç´°ç‰ˆï¼‰
**åˆå‰**:
- 10:00: æœé£Ÿä¼šã§å…¨å“¡ãŒé¡”åˆã‚ã›
- 11:00: ãã‚Œãã‚Œè‡ªç”±è¡Œå‹•

**åˆå¾Œ**:
- 14:00: æ˜¼é£Ÿä¼š
- 16:00: è¢«å®³è€…ãŒé‡è¦ãªç™ºè¡¨ã‚’äºˆå‘Š

**å¤œé–“**:
- 20:00: å¤•é£Ÿä¼š
- 22:00: è¢«å®³è€…ãŒéƒ¨å±‹ã«æˆ»ã‚‹
- 02:00: äº‹ä»¶ç™ºç”Ÿ
- 06:00: éºä½“ç™ºè¦‹

## äº‹ä»¶ç¾å ´è©³ç´°
### ç¾å ´ã®çŠ¶æ³
å¯†å®¤çŠ¶æ…‹ã®è¢«å®³è€…ã®éƒ¨å±‹ã€‚çª“ã¯å†…å´ã‹ã‚‰æ–½éŒ ã€ãƒ‰ã‚¢ã‚‚åŒæ§˜ã€‚

### é‡è¦ãªç‰©çš„è¨¼æ‹ 
- ${randomSelect(MOCK_TEMPLATES.evidence).name}
- ç¾å ´ã«æ®‹ã•ã‚ŒãŸä¸å¯©ãªç—•è·¡
- è¢«å®³è€…ã®æœ€å¾Œã®ãƒ¡ãƒ¢

## ã‚¢ãƒªãƒã‚¤ãƒ»è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³
å„äººç‰©ã®äº‹ä»¶æ™‚åˆ»å‰å¾Œã®è¡Œå‹•ã«ã¯çŸ›ç›¾ç‚¹ãŒ...`;
  }

  /**
   * æ®µéš4: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”Ÿæˆ
   */
  generateStage4(formData, previousData) {
    const participantCount = parseInt(formData.participants) || 5;
    const characters = [];
    
    // çŠ¯äººã‚’æ±ºå®šï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰
    const criminalIndex = randomNumber(0, participantCount - 1);
    
    for (let i = 0; i < participantCount; i++) {
      const name = this.generateUniqueName();
      const age = randomNumber(25, 55);
      const role = randomSelect(MOCK_TEMPLATES.characterTypes);
      const isCriminal = i === criminalIndex;
      
      characters.push(`## ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i + 1}å°‚ç”¨ãƒãƒ³ãƒ‰ã‚¢ã‚¦ãƒˆã€‘

### ã‚ãªãŸã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼
**æ°å**: ${name}
**å¹´é½¢**: ${age}æ­³
**è·æ¥­**: ${role.role}
**æ€§æ ¼**: ${role.traits}
**å¤–è¦‹**: æ¸…æ½”æ„Ÿã®ã‚ã‚‹æœè£…ã€${age < 40 ? 'è‹¥ã€…ã—ã„' : 'è½ã¡ç€ã„ãŸ'}å°è±¡

### ã‚ãªãŸã®èƒŒæ™¯ã¨å‹•æ©Ÿ
${isCriminal ? 
  `ã‚ãªãŸã¯è¢«å®³è€…ã«æ·±ã„æ¨ã¿ã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚è¡¨é¢ä¸Šã¯å‹å¥½çš„ã«æŒ¯ã‚‹èˆã£ã¦ã„ã¾ã—ãŸãŒã€
å¿ƒã®ä¸­ã§ã¯å¾©è®ã®æ©Ÿä¼šã‚’ç‹™ã£ã¦ã„ã¾ã—ãŸã€‚ä»Šå›ã®é›†ã¾ã‚Šã¯ã€ãã®çµ¶å¥½ã®æ©Ÿä¼šã§ã—ãŸã€‚` :
  `ã‚ãªãŸã¯è¢«å®³è€…ã¨ã¯${randomSelect(['å¤ã„å‹äºº', 'ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼', 'è¦ªæˆš', 'çŸ¥äºº'])}ã®é–¢ä¿‚ã§ã—ãŸã€‚
æœ€è¿‘ã€è¢«å®³è€…ã¨ã®é–“ã«${randomSelect(['é‡‘éŠ­ãƒˆãƒ©ãƒ–ãƒ«', 'æ„è¦‹ã®ç›¸é•', 'éå»ã®ç¢ºåŸ·'])}ãŒã‚ã‚Šã¾ã—ãŸã€‚`}

### ã‚ãªãŸã ã‘ãŒçŸ¥ã£ã¦ã„ã‚‹ç§˜å¯†
**é‡è¦ãªç§˜å¯†**: ${isCriminal ? 
  'äº‹ä»¶å½“å¤œã€ã‚ãªãŸã¯è¢«å®³è€…ã®éƒ¨å±‹ã‚’è¨ªã‚Œã¦ã„ãŸ' : 
  randomSelect([
    'è¢«å®³è€…ã‹ã‚‰å€Ÿé‡‘ã‚’ã—ã¦ã„ãŸ',
    'è¢«å®³è€…ã®ç§˜å¯†ã‚’çŸ¥ã£ã¦ã„ãŸ', 
    'è¢«å®³è€…ã¨å£è«–ã—ã¦ã„ãŸ',
    'æ€ªã—ã„äººå½±ã‚’ç›®æ’ƒã—ã¦ã„ãŸ'
  ])}
**éš ã—ãŸã„ã“ã¨**: ${isCriminal ? 'çŠ¯è¡Œã®äº‹å®Ÿ' : 'è‡ªåˆ†ã‚‚ç–‘ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹è¡Œå‹•'}
**ç‰¹åˆ¥ãªçŸ¥è­˜**: ${isCriminal ? 'ãƒˆãƒªãƒƒã‚¯ã®è©³ç´°' : 'äº‹ä»¶è§£æ±ºã®ãƒ’ãƒ³ãƒˆã¨ãªã‚‹æƒ…å ±'}

### ã‚ãªãŸã®ç›®æ¨™ã¨è¡Œå‹•æŒ‡é‡
**ä¸»ç›®æ¨™**: ${isCriminal ? 'çŠ¯è¡Œã‚’éš ã—é€šã™' : 'çœŸå®Ÿã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹'}
**ç§˜å¯†ã®ç›®æ¨™**: ${isCriminal ? 'ä»–ã®äººç‰©ã«ç–‘ã„ã‚’å‘ã‘ã‚‹' : 'è‡ªåˆ†ã®ç§˜å¯†ã‚’å®ˆã‚‹'}
**è¡Œå‹•æŒ‡é‡**: ${isCriminal ? 'å”åŠ›çš„ã«è¦‹ã›ã‹ã‘ã¦æƒ…å ±ã‚’æ“ä½œ' : 'ç©æ¥µçš„ã«æƒ…å ±åé›†'}

### é‡è¦ãªæ‰€æŒå“ãƒ»è¨¼æ‹ 
- ${randomSelect(['æ‰‹å¸³', 'æºå¸¯é›»è©±', 'éµ', 'å†™çœŸ'])}
- ${isCriminal ? 'çŠ¯è¡Œã«é–¢é€£ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆéš ã—ã¦ã„ã‚‹ï¼‰' : 'ç„¡å®Ÿã‚’è¨¼æ˜ã§ãã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã‚¢ã‚¤ãƒ†ãƒ '}

### ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã®é–¢ä¿‚æ€§
å…¨å“¡ã¨é¢è­˜ãŒã‚ã‚Šã€ãã‚Œãã‚Œã«ç•°ãªã‚‹æ„Ÿæƒ…ã‚’æŠ±ã„ã¦ã„ã¾ã™ã€‚
ç‰¹ã«æ³¨æ„ã™ã¹ãäººç‰©ãŒã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“...`);
    }
    
    return characters.join('\n\n---\n\n');
  }

  /**
   * æ®µéš5: è¨¼æ‹ é…ç½®
   */
  generateStage5(formData, previousData) {
    return `## äº‹ä»¶ç™ºç”Ÿãƒ»ç™ºè¦‹ã‚·ãƒ¼ãƒ³ï¼ˆå®Œçµç‰ˆï¼‰
- **äº‹ä»¶ç™ºç”Ÿã®ç¬é–“**: æ·±å¤œ2æ™‚é ƒã€é¤¨ã¯é™å¯‚ã«åŒ…ã¾ã‚Œã¦ã„ãŸã€‚ãã®æ™‚ã€ä¸€ã¤ã®éƒ¨å±‹ã§æ‚²åŠ‡ãŒ...
- **ç™ºè¦‹ã‚·ãƒ¼ãƒ³**: æœ6æ™‚ã€æœé£Ÿã®æº–å‚™ã‚’ã—ã¦ã„ãŸè€…ãŒã€è¿”äº‹ã®ãªã„éƒ¨å±‹ã®ãƒ‰ã‚¢ã‚’é–‹ã‘ã‚‹ã¨...
- **åˆæœŸçŠ¶æ³**: å…¨å“¡ãŒãƒ‘ãƒ‹ãƒƒã‚¯ã«é™¥ã‚‹ä¸­ã€å†·é™ã«çŠ¶æ³ã‚’æŠŠæ¡ã—ã‚ˆã†ã¨ã™ã‚‹è€…ã‚‚

## çŸ­æ™‚é–“è§£æ±ºæ§‹é€ ï¼ˆ30åˆ†-1æ™‚é–“ç‰¹åŒ–ï¼‰
### ã€å°å…¥æ®µéšï¼ˆ5åˆ†ï¼‰ã€‘
- äº‹ä»¶æ¦‚è¦ã®èª¬æ˜
- å„è‡ªã®ãƒãƒ³ãƒ‰ã‚¢ã‚¦ãƒˆç¢ºèª

### ã€èª¿æŸ»æ®µéšï¼ˆ15-35åˆ†ï¼‰ã€‘  
- ç¾å ´æ¤œè¨¼
- ç›¸äº’å°‹å•
- è¨¼æ‹ ã®æ¤œè¨

### ã€è§£æ±ºæ®µéšï¼ˆ10-20åˆ†ï¼‰ã€‘
- æ¨ç†ç™ºè¡¨
- çœŸç›¸è§£æ˜

## è¨¼æ‹ ã‚·ã‚¹ãƒ†ãƒ 
- ${MOCK_TEMPLATES.evidence.map(e => e.name).slice(0, 3).join('\n- ')}
- å„äººç‰©ã®è¨¼è¨€ãƒ¡ãƒ¢
- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®çŸ›ç›¾`;
  }

  /**
   * æ®µéš6: GMé€²è¡Œã‚¬ã‚¤ãƒ‰
   */
  generateStage6(formData, previousData) {
    const timeLimit = formData.complexity === 'simple' ? '30åˆ†' : 
                     formData.complexity === 'complex' ? '60åˆ†' : '45åˆ†';
    
    return `## äº‹å‰æº–å‚™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- ãƒãƒ³ãƒ‰ã‚¢ã‚¦ãƒˆ ${formData.participants}éƒ¨
- è¨¼æ‹ ã‚«ãƒ¼ãƒ‰ä¸€å¼
- ã‚¿ã‚¤ãƒãƒ¼
- ãƒ¡ãƒ¢ç”¨ç´™

## ${timeLimit}å®Œå…¨é€²è¡Œãƒãƒ‹ãƒ¥ã‚¢ãƒ«

### é–‹å§‹å‰ï¼ˆ3åˆ†ï¼‰
- ç°¡å˜ãªãƒ«ãƒ¼ãƒ«èª¬æ˜
- ãƒãƒ³ãƒ‰ã‚¢ã‚¦ãƒˆé…å¸ƒ
- è³ªç–‘å¿œç­”

### å°å…¥ï¼ˆ5-10åˆ†ï¼‰
- äº‹ä»¶ç™ºç”Ÿã®èª¬æ˜
- åˆæœŸæƒ…å ±ã®å…±æœ‰
- èª¿æŸ»é–‹å§‹ã®å®£è¨€

### èª¿æŸ»ï¼ˆ${timeLimit === '30åˆ†' ? '20åˆ†' : timeLimit === '45åˆ†' ? '30åˆ†' : '40åˆ†'}ï¼‰
- è‡ªç”±ãªæƒ…å ±äº¤æ›
- è¨¼æ‹ ã®é–‹ç¤º
- GMã¸ã®è³ªå•å¯¾å¿œ

### è§£æ±ºï¼ˆ5-10åˆ†ï¼‰
- æœ€çµ‚æ¨ç†ã‚¿ã‚¤ãƒ 
- çŠ¯äººæŒ‡å
- çœŸç›¸è§£æ˜

## é€²è¡Œã®ã‚³ãƒ„
- æ™‚é–“ç®¡ç†ã‚’å³å¯†ã«
- å…¨å“¡ãŒç™ºè¨€ã§ãã‚‹ã‚ˆã†é…æ…®
- è¡Œãè©°ã¾ã£ãŸã‚‰ãƒ’ãƒ³ãƒˆã‚’æä¾›`;
  }

  /**
   * æ®µéš7: æœ€çµ‚çµ±åˆ
   */
  generateStage7(formData, previousData) {
    return `## æœ€çµ‚å“è³ªãƒã‚§ãƒƒã‚¯

### è«–ç†çš„æ•´åˆæ€§ âœ“
- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã«çŸ›ç›¾ãªã—
- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãŒæˆç«‹
- è¨¼æ‹ ã¨çœŸç›¸ãŒä¸€è‡´

### ãƒ—ãƒ¬ã‚¤ã‚¢ãƒ“ãƒªãƒ†ã‚£ âœ“
- ${formData.complexity === 'simple' ? '30åˆ†' : formData.complexity === 'complex' ? '60åˆ†' : '45åˆ†'}ã§å®Œçµå¯èƒ½
- é›£æ˜“åº¦ãŒé©åˆ‡
- å…¨å“¡ãŒæ¥½ã—ã‚ã‚‹æ§‹æˆ

### å®Œæˆåº¦è©•ä¾¡
- è«–ç†æ€§: 85/100
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆæ€§: 90/100
- ãƒ—ãƒ¬ã‚¤ã‚¢ãƒ“ãƒªãƒ†ã‚£: 95/100
- ç·åˆè©•ä¾¡: 90/100

ã“ã®ã‚·ãƒŠãƒªã‚ªã¯çŸ­æ™‚é–“ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ååˆ†ãªå“è³ªã‚’æŒã£ã¦ã„ã¾ã™ã€‚`;
  }

  /**
   * æ®µéš8: æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼
   */
  generateStage8(formData, previousData) {
    return `## æœ€çµ‚ç·åˆãƒ¬ãƒ“ãƒ¥ãƒ¼

### ç”Ÿæˆå“è³ªç¢ºèª
å…¨ã¦ã®æ®µéšãŒé©åˆ‡ã«ç”Ÿæˆã•ã‚Œã€ä¸€è²«æ€§ã®ã‚ã‚‹ã‚·ãƒŠãƒªã‚ªãŒå®Œæˆã—ã¾ã—ãŸã€‚

### å•†æ¥­å“è³ªåŸºæº–é©åˆæ€§
- çŸ­æ™‚é–“ãƒ—ãƒ¬ã‚¤ã«æœ€é©åŒ–: 10/10
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆæ€§: 9/10
- ãƒ—ãƒ¬ã‚¤ã‚¢ãƒ“ãƒªãƒ†ã‚£: 10/10

### æœ€çµ‚æ¨å¥¨äº‹é …
1. æ™‚é–“ç®¡ç†ã‚’ç¢ºå®Ÿã«è¡Œã†
2. å…¨å“¡ãŒå‚åŠ ã§ãã‚‹ã‚ˆã†é…æ…®
3. æ¥½ã—ã„é›°å›²æ°—ä½œã‚Šã‚’å¿ƒãŒã‘ã‚‹

### å®Œæˆå®£è¨€
ã“ã®ãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ã¯ã€ç’°å¢ƒå¤‰æ•°ãªã—ã§ã‚‚å®Œå…¨ã«æ©Ÿèƒ½ã™ã‚‹é«˜å“è³ªãªã‚·ãƒŠãƒªã‚ªã§ã™ã€‚
ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§ã®ç”Ÿæˆã§ã™ãŒã€å®Ÿéš›ã®ãƒ—ãƒ¬ã‚¤ã«ååˆ†ä½¿ç”¨å¯èƒ½ãªå†…å®¹ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã€æ³¨æ„ã€‘ã“ã‚Œã¯AIã‚’ä½¿ç”¨ã›ãšã«ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¢ã‚·ãƒŠãƒªã‚ªã§ã™ã€‚
å®Ÿéš›ã®AIç”Ÿæˆç‰ˆã§ã¯ã€ã‚ˆã‚Šè¤‡é›‘ã§ç‹¬å‰µçš„ãªã‚·ãƒŠãƒªã‚ªãŒä½œæˆã•ã‚Œã¾ã™ã€‚`;
  }

  /**
   * çµ±åˆç”Ÿæˆãƒ¡ã‚½ãƒƒãƒ‰
   */
  async generateCompleteScenario(formData) {
    logger.info('ğŸ­ Mock data generation started');
    
    const stages = [
      { name: 'æ®µéš0: ãƒ©ãƒ³ãƒ€ãƒ å…¨ä½“æ§‹é€ ', handler: () => this.generateStage0(formData) },
      { name: 'æ®µéš1: ã‚³ãƒ³ã‚»ãƒ—ãƒˆç²¾å¯†åŒ–', handler: (prev) => this.generateStage1(formData, prev) },
      { name: 'æ®µéš2: äº‹ä»¶æ ¸å¿ƒè¨­è¨ˆ', handler: (prev) => this.generateStage2(formData, prev) },
      { name: 'æ®µéš3: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ§‹ç¯‰', handler: (prev) => this.generateStage3(formData, prev) },
      { name: 'æ®µéš4: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”Ÿæˆ', handler: (prev) => this.generateStage4(formData, prev) },
      { name: 'æ®µéš5: è¨¼æ‹ é…ç½®', handler: (prev) => this.generateStage5(formData, prev) },
      { name: 'æ®µéš6: GMé€²è¡Œã‚¬ã‚¤ãƒ‰', handler: (prev) => this.generateStage6(formData, prev) },
      { name: 'æ®µéš7: æœ€çµ‚çµ±åˆ', handler: (prev) => this.generateStage7(formData, prev) },
      { name: 'æ®µéš8: æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼', handler: (prev) => this.generateStage8(formData, prev) }
    ];
    
    let accumulatedData = { formData, sessionId: this.sessionId };
    
    for (let i = 0; i < stages.length; i++) {
      const stage = stages[i];
      logger.debug(`Generating mock data for ${stage.name}`);
      
      // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦ãƒªã‚¢ãƒªãƒ†ã‚£ã‚’å‡ºã™
      await new Promise(resolve => setTimeout(resolve, 100));
      
      const content = stage.handler(accumulatedData);
      const key = `stage_${i}_content`;
      accumulatedData[key] = content;
      
      // ç‰¹å®šã®æ®µéšã®çµæœã‚’é©åˆ‡ãªã‚­ãƒ¼ã«ä¿å­˜
      switch (i) {
        case 0:
          accumulatedData.random_outline = content;
          break;
        case 1:
          accumulatedData.concept = content;
          break;
        case 2:
          accumulatedData.incident_core = content;
          break;
        case 3:
          accumulatedData.incident_details = content;
          break;
        case 4:
          accumulatedData.characters = content;
          break;
        case 5:
          accumulatedData.evidence_system = content;
          break;
        case 6:
          accumulatedData.gamemaster_guide = content;
          break;
        case 7:
          accumulatedData.final_integration = content;
          break;
        case 8:
          accumulatedData.comprehensive_review = content;
          break;
      }
    }
    
    // æœ€çµ‚çš„ãªã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰
    accumulatedData.title = randomSelect(MOCK_TEMPLATES.titles);
    accumulatedData.description = `${randomSelect(MOCK_TEMPLATES.settings).description}ã‚’èˆå°ã«ã—ãŸæœ¬æ ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ã€‚ç’°å¢ƒå¤‰æ•°ãªã—ã§ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¢ã‚·ãƒŠãƒªã‚ªã§ã™ã€‚`;
    accumulatedData.mockGenerated = true;
    accumulatedData.generatedAt = new Date().toISOString();
    
    logger.success('âœ… Mock scenario generation completed');
    return accumulatedData;
  }
}

// ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
module.exports = {
  MockDataGenerator,
  MOCK_TEMPLATES
};