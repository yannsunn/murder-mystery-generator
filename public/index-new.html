<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ•µï¸ Murder Mystery Generator v2.0</title>
  <meta name="description" content="æ¬¡ä¸–ä»£ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="simple-modern-style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ•µï¸</text></svg>">
  
  <!-- Cache Busting -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
</head>
<body>
  <header>
    <h1>ğŸ•µï¸ Murder Mystery Generator v2.0</h1>
    <p>æ¬¡ä¸–ä»£ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼AIç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ </p>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="main-container">
    <!-- ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ -->
    <div class="card" id="main-card">
      <div class="card-header">
        <h2>ğŸ­ ã‚·ãƒŠãƒªã‚ªç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ </h2>
        <p>AIä¸¦åˆ—å‡¦ç†ã§é«˜å“è³ªãªãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ã‚·ãƒŠãƒªã‚ªã‚’ç”Ÿæˆ</p>
      </div>
      
      <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
      <div class="step-indicator" id="step-indicator">
        <div class="step-indicator-item active" data-step="1" data-title="åŸºæœ¬è¨­å®š">
          <span>1</span>
          <div class="step-title">åŸºæœ¬è¨­å®š</div>
        </div>
        <div class="step-line"></div>
        <div class="step-indicator-item" data-step="2" data-title="ä¸–ç•Œè¦³">
          <span>2</span>
          <div class="step-title">ä¸–ç•Œè¦³</div>
        </div>
        <div class="step-line"></div>
        <div class="step-indicator-item" data-step="3" data-title="äº‹ä»¶è¨­å®š">
          <span>3</span>
          <div class="step-title">äº‹ä»¶è¨­å®š</div>
        </div>
        <div class="step-line"></div>
        <div class="step-indicator-item" data-step="4" data-title="è©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³">
          <span>4</span>
          <div class="step-title">è©³ç´°</div>
        </div>
        <div class="step-line"></div>
        <div class="step-indicator-item" data-step="5" data-title="ç¢ºèªãƒ»ç”Ÿæˆ">
          <span>5</span>
          <div class="step-title">ç”Ÿæˆ</div>
        </div>
      </div>
      
      <!-- ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ -->
      <form id="scenario-form" class="form-container">
        <div id="step-container">
          
          <!-- ã‚¹ãƒ†ãƒƒãƒ—1: åŸºæœ¬è¨­å®š -->
          <div id="step-1" class="step fade-in">
            <div class="step-header">
              <h3 class="text-gradient">ğŸ® åŸºæœ¬è¨­å®š</h3>
              <p>ãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ã®åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã™</p>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="participants" class="form-label">ğŸ‘¥ å‚åŠ äººæ•°</label>
                <select id="participants" name="participants" class="form-select">
                  <option value="4">4äºº (ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ)</option>
                  <option value="5" selected>5äºº (æ¨å¥¨)</option>
                  <option value="6">6äºº (æ¨™æº–)</option>
                  <option value="7">7äºº (å¤§è¦æ¨¡)</option>
                  <option value="8">8äºº (ã‚¨ãƒ”ãƒƒã‚¯)</option>
                </select>
                <div class="form-hint">æ¨å¥¨ã¯5-6äººã§ã™</div>
              </div>
              
              <div class="form-group">
                <label for="era" class="form-label">â° æ™‚ä»£èƒŒæ™¯</label>
                <select id="era" name="era" class="form-select">
                  <option value="modern" selected>ğŸ™ï¸ ç¾ä»£ (2020å¹´ä»£)</option>
                  <option value="showa">ğŸ® æ˜­å’Œ (1926-1989)</option>
                  <option value="near-future">ğŸš€ è¿‘æœªæ¥ (2030å¹´ä»£)</option>
                  <option value="fantasy">ğŸ° ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="setting" class="form-label">ğŸ¢ èˆå°è¨­å®š</label>
                <select id="setting" name="setting" class="form-select">
                  <option value="closed-space" selected>ğŸ  é–‰é–ç©ºé–“ (å¯†å®¤)</option>
                  <option value="mountain-villa">ğŸ”ï¸ å±±è˜ (éš”é›¢)</option>
                  <option value="military-facility">âš”ï¸ è»äº‹æ–½è¨­</option>
                  <option value="underwater-facility">ğŸŒŠ æµ·ä¸­æ–½è¨­</option>
                  <option value="city">ğŸŒ† éƒ½å¸‚éƒ¨</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ä¸–ç•Œè¦³ -->
          <div id="step-2" class="step hidden">
            <div class="step-header">
              <h3 class="text-gradient">ğŸŒŸ ä¸–ç•Œè¦³ã¨ãƒˆãƒ¼ãƒ³</h3>
              <p>ã‚·ãƒŠãƒªã‚ªã®é›°å›²æ°—ã¨ä¸–ç•Œè¦³ã‚’æ±ºå®šã—ã¾ã™</p>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="worldview" class="form-label">ğŸŒ ä¸–ç•Œè¦³</label>
                <select id="worldview" name="worldview" class="form-select">
                  <option value="realistic" selected>ğŸ“± ãƒªã‚¢ãƒ«å¿—å‘ (ç¾å®Ÿçš„)</option>
                  <option value="occult">ğŸ‘» ã‚ªã‚«ãƒ«ãƒˆè¦ç´ ã‚ã‚Š</option>
                  <option value="sci-fi">ğŸ›¸ SFè¦ç´ ã‚ã‚Š</option>
                  <option value="mystery">ğŸ” ç´”ç²‹ãƒŸã‚¹ãƒ†ãƒªãƒ¼</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="tone" class="form-label">ğŸ­ ãƒˆãƒ¼ãƒ³ãƒ»é›°å›²æ°—</label>
                <select id="tone" name="tone" class="form-select">
                  <option value="serious" selected>ğŸ˜ ã‚·ãƒªã‚¢ã‚¹ (é‡åš)</option>
                  <option value="comedy">ğŸ˜„ ã‚³ãƒ¡ãƒ‡ã‚£ (è»½å¿«)</option>
                  <option value="horror">ğŸ˜± ãƒ›ãƒ©ãƒ¼ (ææ€–)</option>
                  <option value="adventure">ğŸ—ºï¸ å†’é™ºæ´»åŠ‡</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- ã‚¹ãƒ†ãƒƒãƒ—3: äº‹ä»¶è¨­å®š -->
          <div id="step-3" class="step hidden">
            <div class="step-header">
              <h3 class="text-gradient">ğŸ” äº‹ä»¶è¨­å®š</h3>
              <p>ç™ºç”Ÿã™ã‚‹äº‹ä»¶ã®ç¨®é¡ã¨è©³ç´°ã‚’è¨­å®šã—ã¾ã™</p>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="incident_type" class="form-label">âš¡ äº‹ä»¶ã®ç¨®é¡</label>
                <select id="incident_type" name="incident_type" class="form-select">
                  <option value="murder" selected>ğŸ’€ æ®ºäººäº‹ä»¶</option>
                  <option value="disappearance">ğŸ‘¤ å¤±è¸ªäº‹ä»¶</option>
                  <option value="theft">ğŸ’ ç›—é›£äº‹ä»¶</option>
                  <option value="blackmail">ğŸ“§ æå–äº‹ä»¶</option>
                  <option value="fraud">ğŸ’° è©æ¬ºäº‹ä»¶</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- ã‚¹ãƒ†ãƒƒãƒ—4: è©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
          <div id="step-4" class="step hidden">
            <div class="step-header">
              <h3 class="text-gradient">âš™ï¸ è©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h3>
              <p>ã‚·ãƒŠãƒªã‚ªã®è¤‡é›‘ã•ã¨ç‰¹æ®Šè¦ç´ ã‚’èª¿æ•´ã—ã¾ã™</p>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="complexity" class="form-label">ğŸ§© è¤‡é›‘ã•ãƒ¬ãƒ™ãƒ«</label>
                <select id="complexity" name="complexity" class="form-select">
                  <option value="simple">ğŸŸ¢ ã‚·ãƒ³ãƒ—ãƒ« (åˆå¿ƒè€…å‘ã‘)</option>
                  <option value="standard" selected>ğŸŸ¡ æ¨™æº– (æ¨å¥¨)</option>
                  <option value="complex">ğŸ”´ è¤‡é›‘ (ä¸Šç´šè€…å‘ã‘)</option>
                </select>
              </div>
              
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="red_herring" name="red_herring" class="checkbox-input">
                  <span class="checkbox-custom"></span>
                  <span class="checkbox-text">ğŸ¯ ãƒ¬ãƒƒãƒ‰ãƒ˜ãƒªãƒ³ã‚° (å½ã®æ‰‹ãŒã‹ã‚Š)</span>
                </label>
                
                <label class="checkbox-label">
                  <input type="checkbox" id="twist_ending" name="twist_ending" class="checkbox-input">
                  <span class="checkbox-custom"></span>
                  <span class="checkbox-text">ğŸŒªï¸ ã©ã‚“ã§ã‚“è¿”ã—</span>
                </label>
                
                <label class="checkbox-label">
                  <input type="checkbox" id="secret_roles" name="secret_roles" class="checkbox-input">
                  <span class="checkbox-custom"></span>
                  <span class="checkbox-text">ğŸ­ ç§˜å¯†ã®å½¹å‰²</span>
                </label>
              </div>
            </div>
          </div>
          
          <!-- ã‚¹ãƒ†ãƒƒãƒ—5: ç¢ºèªãƒ»ç”Ÿæˆ -->
          <div id="step-5" class="step hidden">
            <div class="step-header">
              <h3 class="text-gradient">ğŸš€ æœ€çµ‚ç¢ºèª</h3>
              <p>è¨­å®šã‚’ç¢ºèªã—ã¦ã€è¶…é«˜é€Ÿç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã™</p>
            </div>
            
            <div id="summary-container" class="summary-container">
              <div class="summary-card">
                <h4>ğŸ“‹ è¨­å®šã‚µãƒãƒªãƒ¼</h4>
                <div id="settings-summary" class="settings-summary">
                  <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹è¨­å®šã‚µãƒãƒªãƒ¼ -->
                </div>
              </div>
              
              <div class="generation-info">
                <div class="info-item">
                  <span class="info-icon">âš¡</span>
                  <span class="info-text">äºˆæƒ³ç”Ÿæˆæ™‚é–“: <strong>45ç§’ä»¥å†…</strong></span>
                </div>
                <div class="info-item">
                  <span class="info-icon">ğŸ›¡ï¸</span>
                  <span class="info-text">ãƒ•ã‚§ã‚¤ãƒ«ã‚»ãƒ¼ãƒ•: <strong>Groq â†’ OpenAI</strong></span>
                </div>
                <div class="info-item">
                  <span class="info-icon">ğŸ¯</span>
                  <span class="info-text">æˆåŠŸç‡: <strong>99.9%ä¿è¨¼</strong></span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ - å®Œå…¨å›ºå®šä½ç½® -->
        <div class="button-container">
          <button type="button" id="prev-btn" class="btn btn-secondary" disabled>
            <span>â†</span> å‰ã¸
          </button>
          <div class="btn-spacer"></div>
          <button type="button" id="next-btn" class="btn btn-primary">
            æ¬¡ã¸ <span>â†’</span>
          </button>
          <button type="button" id="stepwise-generation-btn" class="btn btn-success" style="display: none;">
            <span>ğŸš€</span> ç”Ÿæˆé–‹å§‹
          </button>
        </div>
      </form>
    </div>
    
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
    <div id="loading-indicator" class="card hidden">
      <div class="loading-container">
        <div class="loading-header">
          <h3>ğŸš€ AIã‚·ãƒŠãƒªã‚ªç”Ÿæˆä¸­...</h3>
          <div class="progress-percentage" id="progress-percentage">0%</div>
        </div>
        
        <div class="progress-bar-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            <div class="progress-text" id="progress-text">æº–å‚™ä¸­...</div>
          </div>
        </div>
        
        <div class="phase-info">
          <div class="current-phase" id="current-phase">ğŸš€ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...</div>
          <div class="phase-details" id="phase-details">AI ã‚¨ãƒ³ã‚¸ãƒ³èµ·å‹•ä¸­...</div>
        </div>
        
        <div class="loading-stats">
          <div class="stat-item">
            <span class="stat-label">å‡¦ç†ãƒ•ã‚§ãƒ¼ã‚º</span>
            <span class="stat-value" id="current-phase-number">1/8</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">æ¨å®šæ®‹ã‚Šæ™‚é–“</span>
            <span class="stat-value" id="estimated-time">è¨ˆç®—ä¸­...</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">ç”Ÿæˆæ–¹å¼</span>
            <span class="stat-value" id="generation-method">AIä¸¦åˆ—å‡¦ç†</span>
          </div>
        </div>
        
        <!-- ARIA Live Region for Progress Updates -->
        <div id="progress-announcements" aria-live="polite" aria-atomic="true" class="sr-only">
          é€²è¡ŒçŠ¶æ³ã®æ›´æ–°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
        </div>
        
        <div class="loading-spinner"></div>
      </div>
    </div>
    
    <!-- çµæœè¡¨ç¤º -->
    <div id="result-container" class="card hidden">
      <div class="result-header">
        <h2>ğŸ‰ ç”Ÿæˆå®Œäº†</h2>
        <p>ãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ã‚·ãƒŠãƒªã‚ªãŒå®Œæˆã—ã¾ã—ãŸ</p>
      </div>
      
      <div class="result-content">
        <div class="scenario-content" id="scenario-content">
          <!-- ç”Ÿæˆã•ã‚ŒãŸã‚·ãƒŠãƒªã‚ªãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>
      </div>
      
      <div class="result-actions">
        <button id="download-pdf-btn" class="btn btn-success" disabled>
          <span>ğŸ“„</span> PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </button>
        <button id="generate-new-btn" class="btn btn-secondary">
          <span>ğŸ”„</span> æ–°è¦ç”Ÿæˆ
        </button>
        <button id="share-btn" class="btn btn-primary">
          <span>ğŸ“¤</span> ã‚·ã‚§ã‚¢
        </button>
      </div>
    </div>
    
    <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
    <div id="error-container" class="error-container hidden">
      <div class="error-message" id="error-message">
        <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
      </div>
      <button id="retry-btn" class="btn btn-primary" style="margin-top: 1rem;">
        <span>ğŸ”„</span> å†è©¦è¡Œ
      </button>
    </div>
  </main>

  <footer style="text-align: center; padding: 2rem; color: #64748b; font-size: 0.9rem;">
    <p>ğŸ•µï¸ Murder Mystery Generator v2.0 | æ¬¡ä¸–ä»£ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ã‚·ã‚¹ãƒ†ãƒ </p>
  </footer>

  <!-- åˆæœŸåŒ–ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
  <div id="init-overlay" style="
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0,0,0,0.8); 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    z-index: 10000;
    color: white;
    font-family: 'Inter', sans-serif;
  ">
    <div style="text-align: center;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ•µï¸</div>
      <h2 style="margin-bottom: 1rem;">Murder Mystery Generator v2.0</h2>
      <p style="margin-bottom: 2rem;">ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ä¸­...</p>
      <div style="width: 300px; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; overflow: hidden;">
        <div id="init-progress-bar" style="
          width: 0%;
          height: 100%;
          background: linear-gradient(90deg, #667eea, #764ba2);
          border-radius: 2px;
          transition: width 0.3s ease;
        "></div>
      </div>
      <div id="init-status" style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;">
        ã‚·ã‚¹ãƒ†ãƒ æº–å‚™ä¸­...
      </div>
    </div>
  </div>

  <!-- æ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  - ONLY THIS -->
  <script type="module">
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
    const timestamp = Date.now();
    console.log(`ğŸš€ Murder Mystery Generator v2.0 starting... [${timestamp}]`);
    
    // åˆæœŸåŒ–ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
    function updateInitProgress(percentage, message) {
      const progressBar = document.getElementById('init-progress-bar');
      const statusText = document.getElementById('init-status');
      
      if (progressBar) progressBar.style.width = `${percentage}%`;
      if (statusText) statusText.textContent = message;
    }
    
    // åˆæœŸåŒ–ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éš ã™
    function hideInitOverlay() {
      const overlay = document.getElementById('init-overlay');
      if (overlay) {
        overlay.style.opacity = '0';
        overlay.style.transition = 'opacity 0.5s ease';
        setTimeout(() => overlay.remove(), 500);
      }
    }
    
    try {
      updateInitProgress(10, 'ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–ä¸­...');
      
      // ModuleLoader ã®å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
      const { default: ModuleLoader } = await import('./js/core/ModuleLoader.js?v=' + timestamp);
      
      updateInitProgress(30, 'ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’è¨­å®šä¸­...');
      
      const moduleLoader = new ModuleLoader({
        baseUrl: './js',
        timeout: 15000,
        retryCount: 3
      });
      
      updateInitProgress(50, 'ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šä¸­...');
      
      // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
      const APP_CONFIG = {
        environment: 'production',
        api: {
          baseURL: '/api',
          timeout: 30000,
          maxRetries: 3,
          rateLimitDelay: 100
        },
        ui: {
          animationDuration: 300,
          debounceDelay: 300,
          autoSave: true,
          autoSaveInterval: 30000
        },
        steps: {
          totalSteps: 5,
          validateOnChange: true,
          allowStepSkipping: false
        },
        generation: {
          defaultStrategy: 'ultra_phases',
          maxGenerationTime: 300000,
          enableFallback: true,
          qualityThreshold: 80
        },
        logging: {
          level: 'INFO',
          enableColors: true,
          enableTimestamp: true,
          maxLogSize: 1000
        }
      };
      
      updateInitProgress(70, 'ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...');
      
      // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
      const app = await moduleLoader.initializeApp(APP_CONFIG);
      
      updateInitProgress(90, 'UI ã‚·ã‚¹ãƒ†ãƒ ã‚’æº–å‚™ä¸­...');
      
      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å‚ç…§è¨­å®š
      window.app = app;
      window.moduleLoader = moduleLoader;
      
      updateInitProgress(100, 'åˆæœŸåŒ–å®Œäº†ï¼');
      
      // åˆæœŸåŒ–å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
      document.dispatchEvent(new CustomEvent('app:ready', {
        detail: { app, moduleLoader, config: APP_CONFIG }
      }));
      
      console.log('âœ… Murder Mystery Generator v2.0 initialized successfully!');
      console.log('ğŸ“Š System info:', {
        version: '2.0.0',
        modules: moduleLoader.getModuleStats(),
        memory: moduleLoader.checkMemoryUsage()
      });
      
      // åˆæœŸåŒ–ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éš ã™
      setTimeout(hideInitOverlay, 300);
      
    } catch (error) {
      console.error('âŒ Initialization failed:', error);
      updateInitProgress(0, `åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
      
      // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
      const overlay = document.getElementById('init-overlay');
      if (overlay) {
        overlay.innerHTML = `
          <div style="text-align: center; color: #ef4444;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
            <h2 style="margin-bottom: 1rem;">åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼</h2>
            <p style="margin-bottom: 1rem;">${error.message}</p>
            <button onclick="location.reload()" style="
              background: #3b82f6;
              color: white;
              border: none;
              padding: 0.75rem 1.5rem;
              border-radius: 6px;
              cursor: pointer;
            ">å†èª­ã¿è¾¼ã¿</button>
          </div>
        `;
      }
    }
  </script>

  <!-- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° -->
  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼å‡¦ç†
    window.addEventListener('error', (e) => {
      if (e.message && (
        e.message.includes('runtime.lastError') ||
        e.message.includes('Extension context') ||
        e.message.includes('message port closed')
      )) {
        e.preventDefault();
        return false;
      }
    });
    
    window.addEventListener('unhandledrejection', (e) => {
      console.error('Unhandled promise rejection:', e.reason);
    });
  </script>
</body>
</html>